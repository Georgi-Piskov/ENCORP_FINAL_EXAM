# Изпитна Задача: Интелигентен Финансов Анализатор (Expense Tracker & Analyzer)

**Дата:** 29.11.2025 г.

---

## 1. Бизнес Сценарий и Цел

Фирма "TechCorp" иска да оптимизира процеса си по отчитане на разходи. Служителите често губят касови бележки или попълват грешно екселски таблици.

**Целта:** Да се създаде "Proof of Concept" уеб приложение (бонус точки: оптимизирано за смартфон), където служител може да качи снимка на касова бележка + текстово описание или да въведе разход текстово. Системата автоматично трябва да извлече данните, да провери дали разходът отговаря на фирмената политика и да го запише в база данни.

> **Proof of Concept** представлява демо — имплементация (понякога частична, груба или само концептуална) на идея/метод/решение, с цел да се покаже дали е реализируема и работеща на практика. Целта не е да се създаде финален продукт, а да се валидира основната хипотеза: че идеята може да се реализира, че технологично и бизнес е възможна, преди да се вложат сериозни ресурси.

---

## 2. Архитектура и Поток на Данните

| Компонент | Описание |
|-----------|----------|
| **Frontend (Vibecoding)** | Потребителски интерфейс за качване на снимки/текст. Идентифициране на служителите по име и служебен номер. |
| **Backend Logic (n8n)** | Обработка на изображението/текста, валидация и бизнес логика. |
| **Database (Supabase)** | Съхранение на структурираните данни. |

---

## 3. Детайлно изпълнение по етапи

### Етап 1: Настройка на База данни и Фронтенд (Vibecoding + MCP)

#### База данни (Supabase)
- Използване на AI code editor със Supabase чрез MCP
- Използване на промптове (Natural Language) с AI за създаване на структурата

#### Таблици:

**users**
- Две имена на служителя
- ID номер на служителя (няма определен формат на ID-то)
- Таблицата трябва да се популира с имена и ID-та на ръка (PoC проект)

**expenses**
- Снимка (URL към снимката, запазена в клауд директория по избор)
- Търговец (ако се вижда на бележката, иначе се въвежда ръчно)
- Дата на касовата бележка (ако се вижда на бележката, иначе се въвежда ръчно)
- Сума
- Валута
- Категория (спрямо разхода и описанието на служителя)
- Статус (Approved/Rejected/Manual Review) и причина за статуса

**Други таблици** - спрямо изискванията по-долу (опционално)

#### Frontend (React/Vue/Next.js или други)

**Изисквания:**
1. Полета за идентификация на служител: Две имена и ID номер
2. Форма за Upload на файл и текстово поле за коментар
3. **Формати на файлове:** JPG, JPEG, PNG, WEBP, GIF
4. Секция "История" с таблица на разходите на конкретния служител
5. Автоматично обновяване при нов разход или с бутон Refresh
6. Показване на общо похарчени средства + разбивка по категории и статус

**Очакван резултат:** Работещ интерфейс и готова база данни без писане на SQL код на ръка.

---

### Етап 2: n8n Workflow за OCR и Обработка (AI & Automation)

> Няма ограничения за структурата, логиката и броя използвани n8n нодове, AI Агенти и workflow-ове, освен ако не противоречат на инструкциите по-долу.

#### Процеси в n8n:

1. **Webhook Node:** Приема POST заявка от фронтенда (файл + коментар + име + ID)

2. **AI Vision / Multimodal Agent:**
   - AI модел по избор за обработка на изображения
   - Структуриран системен промпт за:
     - Извършване на операции по четене и извличане на информация
     - Определяне на категорията на разхода
     - Преценка дали е в рамките на зададените фирмени лимити
     - Определяне на статус

3. **Допълнителни изисквания:**
   - Проверка дали въведените имена и ID на служителя присъстват в базата (таблица users)
   - Ако името и/или ID-то не съответстват - автоматизацията НЕ трябва да приема и обработва разходи

---

### Етап 3: Бизнес Логика и Валидация

#### "Фирмена Политика за Разходите" (чрез n8n нодове):

| Политика | Категория | Лимит | Условия |
|----------|-----------|-------|---------|
| **1** | Храна | до 50 лв - Approved | Над 50 лв - Manual Review. **Без алкохол** - ако има алкохол → Rejected |
| **2** | Служебни обяди/вечери | до 400 лв - Approved | Над 400 лв - Manual Review. Алкохол е допустим |
| **3** | Цигари | N/A | **Rejected** винаги |
| **4** | Градски транспорт/Такси | до 30 лв - Approved | Над 30 лв - **Rejected** |
| **5** | Пътуване извън града/държавата | N/A | **Manual Review** винаги |
| **6** | Компютри/Монитори/Периферия/Телефони | до 600 лв - Approved | Над 600 лв - **Rejected** |
| **7** | Курсове и обучения | Без лимит - Approved | Само ако са свързани с дейността на фирмата |
| **8** | Всички останали | N/A | **Manual Review** |

**Supabase Node (Update/Insert):** Всички категории разходи и статуси се записват в таблицата expenses.

---

### Етап 4: Сигурност и Error Handling

#### Jailbreak Protection (Input Filtering)
- Данните в полето "Коментар" трябва да се проверяват за jailbreak инструкции
- Ако бъдат намерени - да се отделят и записват в отделна таблица в Supabase или Google Sheet

#### Error Workflow
- Създаване на отделен Error Workflow
- Ако AI моделът не успее да разчете бележката (напр. черна снимка) или Supabase върне грешка:
  - Системата трябва да хване грешката
  - Да я запише в отделна таблица в Supabase или Google Sheet

**Бонус:** Логика, която връща информация за грешката към фронтенда с релевантно съобщение

---

## 4. Бонус Задача: Финансов Директор Dashboard

**Изисквания:**
- Финансовият директор ще има персонално ID за въвеждане в уебстраницата
- При правилно въведено име и ID:
  - Интерфейсът позволява комуникация с AI асистент
  - AI асистентът има достъп до базата с разходите
  - Може да връща информация за: общо разходи, отказани разходи, чакащи одобрение, разходи по служители и т.н.
- **Изискване:** Базата за разходи трябва да е векторна база данни

---

## 5. Критерии за оценка

| Категория | Тежест | Изисквания |
|-----------|--------|------------|
| **Vibecoding Mastery** | 20% | Фронтендът изглежда добре и е функционален. SQL схемата е създадена чрез AI/MCP. |
| **n8n Data Processing** | 30% | Правилно използване на Webhook. Успешно извличане на JSON от AI модел. Правилен запис в базата. |
| **AI Logic Implementation** | 30% | Прецизен System Prompt за категоризация. Работеща логика за филтриране (Policy checks). |
| **Security & Reliability** | 20% | Jailbreak защита. Error Handler за поне един вид грешка. |

---

## Технически Стек (Summary)

- **Frontend:** React/Vue/Next.js (Vibecoding)
- **Backend/Automation:** n8n
- **Database:** Supabase
- **AI:** Multimodal модел за OCR и анализ
- **Hosting:** GitHub Pages (за фронтенда)
- **File Storage:** Cloud storage (по избор)

---

## Статус на Изпълнение

- [ ] Етап 1: База данни и Фронтенд
- [ ] Етап 2: n8n Workflow за OCR
- [ ] Етап 3: Бизнес логика и валидация
- [ ] Етап 4: Сигурност и Error Handling
- [ ] Бонус: Финансов директор Dashboard
