<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TechCorp - Expense Tracker</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="–°–∏—Å—Ç–µ–º–∞ –∑–∞ –ø—Ä–æ—Å–ª–µ–¥—è–≤–∞–Ω–µ –Ω–∞ —Å–ª—É–∂–µ–±–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏ —Å AI —Ä–∞–∑–ø–æ–∑–Ω–∞–≤–∞–Ω–µ">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–†–∞–∑—Ö–æ–¥–∏">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon.svg">
    
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fas fa-receipt"></i>
                <span>TechCorp Expense Tracker</span>
            </div>
            <div class="user-info-container">
                <div class="user-status" id="userStatus">
                    <span class="status-dot offline"></span>
                    <span>–ù–µ —Å—Ç–µ –≤–ª–µ–∑–ª–∏</span>
                </div>
                <button class="btn-logout hidden" id="headerLogoutBtn" title="–ò–∑—Ö–æ–¥">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>–ò–∑—Ö–æ–¥</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Login Section -->
            <section class="card login-section" id="loginSection">
                <h2><i class="fas fa-user-circle"></i> –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ —Å–ª—É–∂–∏—Ç–µ–ª</h2>
                <form id="loginForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName">–ò–º–µ</label>
                            <input type="text" id="firstName" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ –∏–º–µ" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">–§–∞–º–∏–ª–∏—è</label>
                            <input type="text" id="lastName" placeholder="–í—ä–≤–µ–¥–µ—Ç–µ —Ñ–∞–º–∏–ª–∏—è" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="employeeId">–°–ª—É–∂–µ–±–µ–Ω –Ω–æ–º–µ—Ä (ID)</label>
                        <input type="text" id="employeeId" placeholder="–ù–∞–ø—Ä. EMP001" required>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt"></i> –í—Ö–æ–¥
                    </button>
                </form>
                <div class="login-message" id="loginMessage"></div>
            </section>

            <!-- Expense Form Section (Hidden until login) -->
            <section class="card expense-section hidden" id="expenseSection">
                <h2><i class="fas fa-plus-circle"></i> –ù–æ–≤ —Ä–∞–∑—Ö–æ–¥</h2>
                
                <!-- Input Type Tabs -->
                <div class="input-tabs">
                    <button type="button" class="tab-btn active" data-tab="receipt">
                        <i class="fas fa-camera"></i> –°–Ω–∏–º–∫–∞ –Ω–∞ –±–µ–ª–µ–∂–∫–∞
                    </button>
                    <button type="button" class="tab-btn" data-tab="manual">
                        <i class="fas fa-keyboard"></i> –†—ä—á–Ω–æ –≤—ä–≤–µ–∂–¥–∞–Ω–µ
                    </button>
                </div>

                <form id="expenseForm">
                    <!-- Tab Content: Receipt Upload -->
                    <div class="tab-content active" id="receiptTab">
                        <!-- File Upload -->
                        <div class="form-group">
                            <label>–°–Ω–∏–º–∫–∞ –Ω–∞ –∫–∞—Å–æ–≤–∞ –±–µ–ª–µ–∂–∫–∞</label>
                            <div class="file-upload-wrapper">
                                <input type="file" id="receiptFile" accept=".jpg,.jpeg,.png,.webp,.gif">
                                <div class="file-upload-area" id="fileUploadArea">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>–ü–ª—ä–∑–Ω–µ—Ç–µ —Ñ–∞–π–ª —Ç—É–∫ –∏–ª–∏ –∫–ª–∏–∫–Ω–µ—Ç–µ –∑–∞ –∏–∑–±–æ—Ä</p>
                                    <span class="file-types">JPG, JPEG, PNG, WEBP, GIF</span>
                                </div>
                                <div class="file-preview hidden" id="filePreview">
                                    <img id="previewImage" src="" alt="Preview">
                                    <button type="button" class="btn-remove" id="removeFile">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Comment for receipt -->
                        <div class="form-group">
                            <label for="comment">–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–µ–Ω –∫–æ–º–µ–Ω—Ç–∞—Ä (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ)</label>
                            <textarea id="comment" rows="3" placeholder="–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ä–∞–∑—Ö–æ–¥–∞..."></textarea>
                        </div>
                    </div>

                    <!-- Tab Content: Manual Entry -->
                    <div class="tab-content" id="manualTab">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="manualMerchant">–¢—ä—Ä–≥–æ–≤–µ—Ü / –î–æ—Å—Ç–∞–≤—á–∏–∫ *</label>
                                <input type="text" id="manualMerchant" placeholder="–ù–∞–ø—Ä. Lidl, OMV, Happy...">
                            </div>
                            <div class="form-group">
                                <label for="manualReceiptNumber">–ù–æ–º–µ—Ä –Ω–∞ –∫–∞—Å–æ–≤–∞ –±–µ–ª–µ–∂–∫–∞</label>
                                <input type="text" id="manualReceiptNumber" placeholder="–ù–∞–ø—Ä. 0001234567">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="manualDate">–î–∞—Ç–∞ –Ω–∞ —Ä–∞–∑—Ö–æ–¥–∞ *</label>
                                <input type="date" id="manualDate">
                            </div>
                            <div class="form-group">
                                <label for="manualCurrency">–í–∞–ª—É—Ç–∞</label>
                                <select id="manualCurrency">
                                    <option value="BGN" selected>BGN (–ª–≤)</option>
                                    <option value="EUR">EUR (‚Ç¨)</option>
                                    <option value="USD">USD ($)</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="manualAmount">–°—É–º–∞ *</label>
                                <input type="number" id="manualAmount" step="0.01" min="0" placeholder="0.00">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="manualCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                            <select id="manualCategory">
                                <option value="">-- –ò–∑–±–µ—Ä–µ—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è --</option>
                                <option value="food">üçî –•—Ä–∞–Ω–∞ (–º–∞–≥–∞–∑–∏–Ω, –∑–∞–∫—É—Å–∫–∏)</option>
                                <option value="business_meal">üçΩÔ∏è –°–ª—É–∂–µ–±–µ–Ω –æ–±—è–¥/–≤–µ—á–µ—Ä—è</option>
                                <option value="transport">üöï –ì—Ä–∞–¥—Å–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç / –¢–∞–∫—Å–∏</option>
                                <option value="travel">‚úàÔ∏è –ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞ (–ø—ä—Ç—É–≤–∞–Ω–µ)</option>
                                <option value="equipment">üíª –û–±–æ—Ä—É–¥–≤–∞–Ω–µ (–∫–æ–º–ø—é—Ç—Ä–∏, —Ç–µ–ª–µ—Ñ–æ–Ω–∏)</option>
                                <option value="training">üìö –û–±—É—á–µ–Ω–∏–µ / –ö—É—Ä—Å–æ–≤–µ</option>
                                <option value="other">üì¶ –î—Ä—É–≥–∏</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="manualDescription">–û–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Ä–∞–∑—Ö–æ–¥–∞ *</label>
                            <textarea id="manualDescription" rows="3" placeholder="–û–ø–∏—à–µ—Ç–µ –∑–∞ –∫–∞–∫–≤–æ –µ —Ä–∞–∑—Ö–æ–¥—ä—Ç..."></textarea>
                        </div>

                        <!-- Optional: Attach receipt for manual entry too -->
                        <div class="form-group">
                            <label>–ü—Ä–∏–∫–∞—á–∏ —Å–Ω–∏–º–∫–∞ (–Ω–µ–∑–∞–¥—ä–ª–∂–∏—Ç–µ–ª–Ω–æ)</label>
                            <div class="file-upload-wrapper small">
                                <input type="file" id="manualReceiptFile" accept=".jpg,.jpeg,.png,.webp,.gif">
                                <div class="file-upload-area small" id="manualFileUploadArea">
                                    <i class="fas fa-paperclip"></i>
                                    <span>–ü—Ä–∏–∫–∞—á–∏ —Ñ–∞–π–ª</span>
                                </div>
                                <div class="file-preview small hidden" id="manualFilePreview">
                                    <span id="manualFileName"></span>
                                    <button type="button" class="btn-remove small" id="manualRemoveFile">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <input type="hidden" id="inputMode" value="receipt">

                    <button type="submit" class="btn btn-primary btn-large">
                        <i class="fas fa-paper-plane"></i> –ò–∑–ø—Ä–∞—Ç–∏ —Ä–∞–∑—Ö–æ–¥
                    </button>
                </form>
                <div class="expense-message" id="expenseMessage"></div>
            </section>

            <!-- Director Dashboard (Hidden - only for admins) -->
            <section class="card director-section hidden" id="directorSection">
                <h2><i class="fas fa-user-tie"></i> –î–∏—Ä–µ–∫—Ç–æ—Ä Dashboard</h2>
                <p class="director-intro">–î–æ–±—Ä–µ –¥–æ—à–ª–∏! –ú–æ–∂–µ—Ç–µ –¥–∞ –∑–∞–¥–∞–≤–∞—Ç–µ –≤—ä–ø—Ä–æ—Å–∏ –∑–∞ —Ä–∞–∑—Ö–æ–¥–∏—Ç–µ –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è—Ç–∞.</p>
                
                <!-- Chat Interface -->
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="chat-message assistant">
                            <div class="message-avatar"><i class="fas fa-robot"></i></div>
                            <div class="message-content">
                                <p>–ó–¥—Ä–∞–≤–µ–π—Ç–µ! –ê–∑ —Å—ä–º –≤–∞—à–∏—è—Ç AI –∞—Å–∏—Å—Ç–µ–Ω—Ç –∑–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –∞–Ω–∞–ª–∏–∑. –ú–æ–∂–µ—Ç–µ –¥–∞ –º–µ –ø–∏—Ç–∞—Ç–µ –∑–∞:</p>
                                <ul>
                                    <li>–û–±—â–∏ —Ä–∞–∑—Ö–æ–¥–∏ –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—è—Ç–∞</li>
                                    <li>–†–∞–∑—Ö–æ–¥–∏ –ø–æ —Å–ª—É–∂–∏—Ç–µ–ª–∏</li>
                                    <li>–û–¥–æ–±—Ä–µ–Ω–∏/–æ—Ç–∫–∞–∑–∞–Ω–∏/—á–∞–∫–∞—â–∏ —Ä–∞–∑—Ö–æ–¥–∏</li>
                                    <li>–†–∞–∑—Ö–æ–¥–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
                                    <li>–¢–µ–Ω–¥–µ–Ω—Ü–∏–∏ –∏ –∞–Ω–∞–ª–∏–∑–∏</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="chat-input-container">
                        <input type="text" id="chatInput" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤—ä–ø—Ä–æ—Å –∑–∞ —Ä–∞–∑—Ö–æ–¥–∏—Ç–µ..." />
                        <button type="button" id="sendChatBtn" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Quick Stats for Director -->
                <div class="director-quick-stats" id="directorQuickStats">
                    <h3><i class="fas fa-chart-bar"></i> –ë—ä—Ä–∑ –ø—Ä–µ–≥–ª–µ–¥</h3>
                    <div class="quick-stats-grid">
                        <div class="quick-stat">
                            <span class="stat-label">–û–±—â–æ —Ä–∞–∑—Ö–æ–¥–∏</span>
                            <span class="stat-value" id="dirTotalExpenses">-</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-label">–ë—Ä–æ–π –∑–∞–ø–∏—Å–∏</span>
                            <span class="stat-value" id="dirTotalCount">-</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-label">–û–¥–æ–±—Ä–µ–Ω–∏</span>
                            <span class="stat-value" id="dirApprovedCount">-</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-label">–ß–∞–∫–∞—â–∏</span>
                            <span class="stat-value" id="dirPendingCount">-</span>
                        </div>
                        <div class="quick-stat">
                            <span class="stat-label">–û—Ç–∫–∞–∑–∞–Ω–∏</span>
                            <span class="stat-value" id="dirRejectedCount">-</span>
                        </div>
                    </div>
                </div>

                <!-- Pending Approvals Section -->
                <div class="pending-approvals-section" id="pendingApprovalsSection">
                    <h3><i class="fas fa-clock"></i> –ß–∞–∫–∞—â–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ</h3>
                    <div class="pending-list" id="pendingList">
                        <!-- Populated by JS -->
                    </div>
                    <div class="no-pending hidden" id="noPendingMessage">
                        <i class="fas fa-check-circle"></i>
                        <p>–ù—è–º–∞ —Ä–∞–∑—Ö–æ–¥–∏ —á–∞–∫–∞—â–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–µ</p>
                    </div>
                </div>
            </section>

            <!-- History Section (Hidden until login) -->
            <section class="card history-section hidden" id="historySection">
                <div class="section-header">
                    <h2><i class="fas fa-history"></i> –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ —Ä–∞–∑—Ö–æ–¥–∏—Ç–µ</h2>
                    <button class="btn btn-secondary" id="refreshBtn">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏
                    </button>
                </div>

                <!-- Summary Cards -->
                <div class="summary-cards" id="summaryCards">
                    <div class="summary-card total">
                        <div class="summary-icon"><i class="fas fa-wallet"></i></div>
                        <div class="summary-content">
                            <span class="summary-label">–û–±—â–æ —Ä–∞–∑—Ö–æ–¥–∏</span>
                            <span class="summary-value" id="totalAmount">0.00 –ª–≤</span>
                        </div>
                    </div>
                    <div class="summary-card approved">
                        <div class="summary-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="summary-content">
                            <span class="summary-label">–û–¥–æ–±—Ä–µ–Ω–∏</span>
                            <span class="summary-value" id="approvedAmount">0.00 –ª–≤</span>
                        </div>
                    </div>
                    <div class="summary-card pending">
                        <div class="summary-icon"><i class="fas fa-clock"></i></div>
                        <div class="summary-content">
                            <span class="summary-label">–ß–∞–∫–∞—â–∏</span>
                            <span class="summary-value" id="pendingAmount">0.00 –ª–≤</span>
                        </div>
                    </div>
                    <div class="summary-card rejected">
                        <div class="summary-icon"><i class="fas fa-times-circle"></i></div>
                        <div class="summary-content">
                            <span class="summary-label">–û—Ç–∫–∞–∑–∞–Ω–∏</span>
                            <span class="summary-value" id="rejectedAmount">0.00 –ª–≤</span>
                        </div>
                    </div>
                </div>

                <!-- Category Breakdown -->
                <div class="category-breakdown" id="categoryBreakdown">
                    <h3><i class="fas fa-chart-pie"></i> –†–∞–∑–±–∏–≤–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <div class="category-list" id="categoryList">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Expenses Table -->
                <div class="expenses-table-wrapper">
                    <table class="expenses-table" id="expensesTable">
                        <thead>
                            <tr>
                                <th>–î–∞—Ç–∞</th>
                                <th>–¢—ä—Ä–≥–æ–≤–µ—Ü</th>
                                <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                <th>–°—É–º–∞</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ—Ç–∞–π–ª–∏</th>
                            </tr>
                        </thead>
                        <tbody id="expensesTableBody">
                            <!-- Populated by JS -->
                        </tbody>
                    </table>
                    <div class="no-data hidden" id="noDataMessage">
                        <i class="fas fa-inbox"></i>
                        <p>–ù—è–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–Ω–∏ —Ä–∞–∑—Ö–æ–¥–∏</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2025 TechCorp. Proof of Concept - Expense Tracker</p>
        </footer>
    </div>

    <!-- Modal for expense details -->
    <div class="modal hidden" id="detailsModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">&times;</button>
            <h3><i class="fas fa-file-invoice"></i> –î–µ—Ç–∞–π–ª–∏ –∑–∞ —Ä–∞–∑—Ö–æ–¥–∞</h3>
            <div class="modal-body" id="modalBody">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay hidden" id="loadingOverlay">
        <div class="spinner"></div>
        <p>–û–±—Ä–∞–±–æ—Ç–∫–∞...</p>
    </div>

    <!-- PWA Install Prompt -->
    <div class="pwa-install-prompt hidden" id="pwaInstallPrompt">
        <div class="pwa-install-content">
            <i class="fas fa-mobile-alt"></i>
            <span>–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ—Ç–æ</span>
            <button class="btn-pwa-install" id="pwaInstallBtn">–ò–Ω—Å—Ç–∞–ª–∏—Ä–∞–π</button>
            <button class="btn-pwa-close" id="pwaCloseBtn">&times;</button>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/app.js"></script>
    
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('SW registered:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        const pwaPrompt = document.getElementById('pwaInstallPrompt');
        const pwaInstallBtn = document.getElementById('pwaInstallBtn');
        const pwaCloseBtn = document.getElementById('pwaCloseBtn');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            pwaPrompt.classList.remove('hidden');
        });
        
        pwaInstallBtn?.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('PWA install:', outcome);
                deferredPrompt = null;
                pwaPrompt.classList.add('hidden');
            }
        });
        
        pwaCloseBtn?.addEventListener('click', () => {
            pwaPrompt.classList.add('hidden');
        });
        
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed');
            pwaPrompt.classList.add('hidden');
        });
    </script>
</body>
</html>
